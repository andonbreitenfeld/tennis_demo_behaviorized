<root BTCPP_format="4" main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">
    <Sequence name="RootSequence">
      <SubTree ID="StartupSequence" bin_nav_pose="{bin_nav_pose}"/>

      <!-- Patrol between 2 Waypoints -->
      <Repeat num_cycles="-1">
        <Sequence name="PatrolSequence">

          <NavigateToPose
              robot_nav_namespace="spot_nav"
              target_pose="{poseA}"/>

          <NavigateToPose
              robot_nav_namespace="spot_nav"
              target_pose="{poseB}"/>

        </Sequence>
      </Repeat>
      
    </Sequence>
  </BehaviorTree>



  <!-- Robot & Bin Initialization -->
  <BehaviorTree ID="StartupSequence" bin_nav_pose="{bin_nav_pose}">
    <Sequence name="StartupRootSequence">

      <!-- Parameters -->
      <Script code="bin_nav_frame:='spot_nav/map'"/>
      <Script code="bin_tag_frame:='bin_tag_link'"/>
      <Script code="bin_standoff:=1.3"/>

      <!-- Robot Initialization -->
      <Sequence name="RobotBootSequence">
        <TriggerService service_name="/spot_driver/claim"    timeout="5.0"/>
        <TriggerService service_name="/spot_driver/power_on" timeout="10.0"/>
        <TriggerService service_name="/spot_driver/undock"   timeout="10.0"/>
      </Sequence>

      <!-- Bin Initialization -->
      <RetryUntilSuccessful num_attempts="-1">
        <Sequence name="InitializeBin">

          <LookupTF ref_frame="{bin_nav_frame}"
                    target_frame="{bin_tag_frame}"
                    pose="{bin_tag_pose}"
                    timeout_secs="1.0"/>

          <ComputeBinApproachGoal 
              tag_pose="{bin_tag_pose}"
              standoff="{bin_standoff}"
              bin_nav_pose="{bin_nav_pose}"/>

        </Sequence>
      </RetryUntilSuccessful>

    </Sequence>
  </BehaviorTree>

</root>
